<Window x:Class="SqlDiagnostics.UI.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:SqlDiagnostics.UI.Wpf.ViewModels"
        mc:Ignorable="d"
        Title="SQL Diagnostics Monitor"
        Height="520" Width="880">
    <Window.DataContext>
        <vm:RealtimeDiagnosticsViewModel />
    </Window.DataContext>
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border Padding="12" Background="#f7f9fc" CornerRadius="6" BorderBrush="#d0d7e3" BorderThickness="1">
            <Grid VerticalAlignment="Center">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0"
                           Text="Connection String:"
                           VerticalAlignment="Center"
                           FontWeight="SemiBold"/>

                <TextBox Grid.Row="0" Grid.Column="1"
                         Margin="8,0,0,0"
                         MinWidth="320"
                         Text="{Binding ConnectionString, UpdateSourceTrigger=PropertyChanged}"
                         ToolTip="SQL Server connection string" />

                <Button Grid.Row="0" Grid.Column="2"
                        Content="Start"
                        Width="80"
                        Margin="12,0,0,0"
                        Command="{Binding StartCommand}"
                        IsEnabled="{Binding IsStartEnabled}" />

                <Button Grid.Row="0" Grid.Column="3"
                        Content="Stop"
                        Width="80"
                        Margin="12,0,0,0"
                        Command="{Binding StopCommand}"
                        IsEnabled="{Binding IsMonitoring}" />

                <WrapPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4" Margin="0,12,0,0" ItemWidth="190" ItemHeight="Auto" Orientation="Horizontal">
                    <Button Content="Connection Quality…"
                            Width="180"
                            Margin="0,0,12,8"
                            Click="OnShowConnectionQuality" />
                    <Button Content="Quick Triage…"
                            Width="160"
                            Margin="0,0,12,8"
                            IsEnabled="{Binding CanOpenQuickTriage}"
                            Click="OnShowQuickTriage"/>
                    <Button Content="Full Diagnostics…"
                            Width="170"
                            Margin="0,0,12,8"
                            IsEnabled="{Binding CanOpenFullDiagnostics}"
                            Click="OnShowFullDiagnostics"/>
                </WrapPanel>
            </Grid>
        </Border>

        <StackPanel Grid.Row="1" Margin="0,16,0,0">
            <TextBlock Text="{Binding StatusMessage}" FontSize="14" FontWeight="SemiBold"/>
            <TextBlock Text="{Binding LastUpdatedDisplay}" Foreground="Gray"/>
        </StackPanel>

        <ScrollViewer Grid.Row="2" Margin="0,16,0,0" VerticalScrollBarVisibility="Auto">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Padding="16" Background="White" CornerRadius="6" BorderBrush="#d0d7e3" BorderThickness="1" Margin="0,0,12,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="Connection Metrics" FontSize="16" FontWeight="SemiBold"/>

                        <UniformGrid Grid.Row="1" Columns="2" Margin="0,12,0,0" HorizontalAlignment="Left">
                            <StackPanel Margin="0,0,12,12">
                                <TextBlock Text="Success Rate" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding SuccessRateDisplay}" FontSize="16"/>
                            </StackPanel>
                            <StackPanel Margin="0,0,12,12">
                                <TextBlock Text="Attempts (Success / Fail)" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding AttemptSummary}" FontSize="16"/>
                            </StackPanel>
                            <StackPanel Margin="0,0,12,12">
                                <TextBlock Text="Avg Connect Time" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding AverageConnectionTimeDisplay}" FontSize="16"/>
                            </StackPanel>
                            <StackPanel Margin="0,0,12,12">
                                <TextBlock Text="Min / Max" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding MinMaxConnectionDisplay}" FontSize="16"/>
                            </StackPanel>
                        </UniformGrid>

                        <Separator Grid.Row="2" Margin="0,16,0,16"/>

                        <StackPanel Grid.Row="3">
                            <TextBlock Text="Network Metrics" FontSize="16" FontWeight="SemiBold"/>
                            <StackPanel Margin="0,12,0,0">
                                <TextBlock Text="Target Host" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding NetworkEndpointDisplay}" FontSize="16"/>
                            </StackPanel>
                            <UniformGrid Columns="3" Margin="12,12,0,0">
                                <StackPanel Margin="0,0,12,0">
                                    <TextBlock Text="Avg RTT" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding NetworkLatencyDisplay}" FontSize="16"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,12,0">
                                    <TextBlock Text="Jitter" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding NetworkJitterDisplay}" FontSize="16"/>
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="Status" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding NetworkStatus}" FontSize="16"/>
                                </StackPanel>
                            </UniformGrid>
                            <StackPanel Margin="0,16,0,0">
                                <TextBlock Text="DNS Resolution" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding DnsResolutionDisplay}" FontSize="16"/>
                                <TextBlock Text="{Binding DnsAddressesDisplay}" Foreground="Gray" TextWrapping="Wrap" Margin="0,4,0,0"/>
                            </StackPanel>
                            <StackPanel Margin="0,16,0,0">
                                <TextBlock Text="Port Connectivity" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding PortStatusDisplay}" FontSize="16"/>
                                <TextBlock Text="{Binding PortRoundtripDisplay}" FontSize="14" Foreground="Gray" Margin="0,4,0,0"/>
                                <TextBlock Text="{Binding PortFailureDisplay}" Foreground="Crimson" TextWrapping="Wrap" Visibility="{Binding PortFailureVisibility}" Margin="0,4,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Grid.Column="1" Padding="16" Background="White" CornerRadius="6" BorderBrush="#d0d7e3" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Recommendations" FontSize="16" FontWeight="SemiBold"/>
                        <ItemsControl ItemsSource="{Binding Recommendations}" Margin="0,12,0,0">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Padding="8" Margin="0,0,0,8" Background="#f3f6fb" CornerRadius="4">
                                        <StackPanel>
                                            <TextBlock Text="{Binding Title}" FontWeight="Bold"/>
                                            <TextBlock Text="{Binding Message}" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                            <ItemsControl.Style>
                                <Style TargetType="ItemsControl">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasRecommendations}" Value="False">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.Style>
                        </ItemsControl>
                        <TextBlock Text="No recommendations yet." Foreground="Gray" Visibility="{Binding NoRecommendationsVisibility}" Margin="0,12,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </ScrollViewer>
    </Grid>
</Window>
